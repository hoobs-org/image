#!/bin/bash

version() {
	case $1 in
		armbian )
			echo `node -e 'console.log(require("./package.json").engines.armbian)'`
			;;

		nodesource )
			echo `node -e 'console.log(require("./package.json").engines.nodesource)'`
			;;

		node )
			echo `node -e 'console.log(require("./package.json").engines.node)'`
			;;

		* )
			echo `node -e 'console.log(require("./package.json").version)'`
			;;
	esac
}

boards() {
	for board in config/boards/*.conf; do
		printf "$(head -2 "${board}" | tail -1 | sed 's/export //' | sed 's/BOARD_NAME="//' | sed 's/"//')\033[1;30m$(head -1 "${board}" | cut -d'#' -f2)\033[0m\n"
	done
}

build() {
	case $1 in
        vendor )
            make vendor
            ;;

        package )
            if [[ "$OSTYPE" == "darwin"* ]]; then
                (cd ../ && ./project pull)

                printf "\033[0;36mBuild package\033[0m\n"
                make darwin
            fi

            ;;

		box )
			make box
			;;

		card )
			make card
			;;

		* )
			./compile $(version)
			;;
	esac
}

rebuild() {
	sudo make clean
	build $@
}

publish() {
    case $1 in
        stable | edge | bleeding )
            reprepro -b ../repo/debian includedeb $1 output/packages/hbs-vendor-$(version)-hoobs-all.deb
            ;;
    esac
}

case $1 in
	version )
		shift

		version $@
		;;

	boards )
		boards
		;;

	build )
		shift

		build $@
		;;

	rebuild )
		rebuild
		;;

	publish )
		;;

	clean )
		sudo make clean
		;;
esac
